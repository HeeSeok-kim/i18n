---
id: organizingsuites
title: سازماندهی مجموعه تست‌ها
---

با رشد پروژه‌ها، به طور اجتناب‌ناپذیری تست‌های یکپارچگی بیشتری اضافه می‌شوند. این امر باعث افزایش زمان ساخت و کاهش بهره‌وری می‌شود.

برای جلوگیری از این مشکل، باید تست‌های خود را به صورت موازی اجرا کنید. WebdriverIO از قبل هر مشخصه (یا _فایل ویژگی_ در Cucumber) را به صورت موازی در یک جلسه واحد آزمایش می‌کند. به طور کلی، سعی کنید فقط یک ویژگی را در هر فایل مشخصه آزمایش کنید. سعی کنید تست‌های بسیار زیاد یا بسیار کم در یک فایل نداشته باشید (با این حال، هیچ قاعده طلایی در اینجا وجود ندارد).

پس از اینکه تست‌های شما چندین فایل مشخصه داشتند، باید اجرای تست‌های خود را به صورت همزمان شروع کنید. برای انجام این کار، ویژگی `maxInstances` را در فایل پیکربندی خود تنظیم کنید. WebdriverIO به شما امکان می‌دهد آزمایش‌های خود را با حداکثر همزمانی اجرا کنید - به این معنی که مهم نیست چند فایل و آزمایش دارید، همه می‌توانند به صورت موازی اجرا شوند (این همچنان به محدودیت‌هایی مانند CPU رایانه شما، محدودیت‌های همزمانی و غیره بستگی دارد).

> فرض کنید 3 قابلیت مختلف (Chrome، Firefox و Safari) دارید و `maxInstances` را روی `1` تنظیم کرده‌اید. اجراکننده تست WDIO 3 فرآیند را راه‌اندازی می‌کند. بنابراین، اگر 10 فایل مشخصه دارید و `maxInstances` را روی `10` تنظیم کنید، _همه_ فایل‌های مشخصه به طور همزمان آزمایش می‌شوند و 30 فرآیند راه‌اندازی می‌شود.

شما می‌توانید ویژگی `maxInstances` را به صورت سراسری تعریف کنید تا ویژگی را برای همه مرورگرها تنظیم کنید.

اگر شبکه WebDriver خود را اجرا می‌کنید، ممکن است (به عنوان مثال) برای یک مرورگر ظرفیت بیشتری نسبت به مرورگر دیگر داشته باشید. در این حالت، می‌توانید `maxInstances` را در شیء قابلیت خود _محدود_ کنید:

```js
// wdio.conf.js
export const config = {
    // ...
    // set maxInstance for all browser
    maxInstances: 10,
    // ...
    capabilities: [{
        browserName: 'firefox'
    }, {
        // maxInstances can get overwritten per capability. So if you have an in-house WebDriver
        // grid with only 5 firefox instance available you can make sure that not more than
        // 5 instance gets started at a time.
        browserName: 'chrome'
    }],
    // ...
}
```

## ارث‌بری از فایل پیکربندی اصلی

اگر مجموعه آزمون خود را در محیط‌های متعددی اجرا می‌کنید (مانند توسعه و یکپارچگی)، ممکن است استفاده از چندین فایل پیکربندی برای مدیریت بهتر امور کمک کند.

مشابه با [مفهوم شیء صفحه](pageobjects)، اولین چیزی که نیاز دارید یک فایل پیکربندی اصلی است. این فایل شامل تمام پیکربندی‌هایی است که در محیط‌های مختلف به اشتراک می‌گذارید.

سپس برای هر محیط یک فایل پیکربندی دیگر ایجاد کنید و پیکربندی اصلی را با پیکربندی‌های مخصوص محیط تکمیل کنید:

```js
// wdio.dev.config.js
import { deepmerge } from 'deepmerge-ts'
import wdioConf from './wdio.conf.js'

// have main config file as default but overwrite environment specific information
export const config = deepmerge(wdioConf.config, {
    capabilities: [
        // more caps defined here
        // ...
    ],

    // run tests on sauce instead locally
    user: process.env.SAUCE_USERNAME,
    key: process.env.SAUCE_ACCESS_KEY,
    services: ['sauce']
}, { clone: false })

// add an additional reporter
config.reporters.push('allure')
```

## گروه‌بندی مشخصات تست در مجموعه‌ها

شما می‌توانید مشخصات تست را در مجموعه‌ها گروه‌بندی کنید و مجموعه‌های خاص را به جای همه آنها اجرا کنید.

ابتدا، مجموعه‌های خود را در پیکربندی WDIO تعریف کنید:

```js
// wdio.conf.js
export const config = {
    // define all tests
    specs: ['./test/specs/**/*.spec.js'],
    // ...
    // define specific suites
    suites: {
        login: [
            './test/specs/login.success.spec.js',
            './test/specs/login.failure.spec.js'
        ],
        otherFeature: [
            // ...
        ]
    },
    // ...
}
```

حالا، اگر می‌خواهید فقط یک مجموعه را اجرا کنید، می‌توانید نام مجموعه را به عنوان آرگومان CLI ارسال کنید:

```sh
wdio wdio.conf.js --suite login
```

یا، چندین مجموعه را همزمان اجرا کنید:

```sh
wdio wdio.conf.js --suite login --suite otherFeature
```

## گروه‌بندی مشخصات تست برای اجرای متوالی

همانطور که در بالا توضیح داده شد، مزایایی در اجرای همزمان تست‌ها وجود دارد. با این حال، مواردی وجود دارد که گروه‌بندی تست‌ها برای اجرای متوالی در یک نمونه واحد مفید خواهد بود. نمونه‌هایی از این موارد عمدتاً جایی است که هزینه راه‌اندازی بزرگی وجود دارد، مانند ترانسپایل کردن کد یا تأمین نمونه‌های ابری، اما همچنین مدل‌های استفاده پیشرفته‌ای نیز وجود دارند که از این قابلیت بهره می‌برند.

برای گروه‌بندی تست‌ها به منظور اجرا در یک نمونه منفرد، آنها را به عنوان یک آرایه در تعریف specs تعریف کنید.

```json
    "specs": [
        [
            "./test/specs/test_login.js",
            "./test/specs/test_product_order.js",
            "./test/specs/test_checkout.js"
        ],
        "./test/specs/test_b*.js",
    ],
```
در مثال بالا، تست‌های 'test_login.js'، 'test_product_order.js' و 'test_checkout.js' به صورت متوالی در یک نمونه واحد اجرا خواهند شد و هر یک از تست‌های "test_b*" به صورت همزمان در نمونه‌های جداگانه اجرا خواهند شد.

همچنین می‌توان مشخصات تعریف شده در مجموعه‌ها را گروه‌بندی کرد، بنابراین اکنون می‌توانید مجموعه‌ها را به صورت زیر نیز تعریف کنید:
```json
    "suites": {
        end2end: [
            [
                "./test/specs/test_login.js",
                "./test/specs/test_product_order.js",
                "./test/specs/test_checkout.js"
            ]
        ],
        allb: ["./test/specs/test_b*.js"]
},
```
و در این مورد، تمام تست‌های مجموعه "end2end" در یک نمونه واحد اجرا می‌شوند.

هنگام اجرای تست‌ها به صورت متوالی با استفاده از یک الگو، فایل‌های مشخصه را به ترتیب الفبایی اجرا می‌کند

```json
  "suites": {
    end2end: ["./test/specs/test_*.js"]
  },
```

این فایل‌های منطبق با الگوی بالا را به ترتیب زیر اجرا می‌کند:

```
  [
      "./test/specs/test_checkout.js",
      "./test/specs/test_login.js",
      "./test/specs/test_product_order.js"
  ]
```

## اجرای تست‌های انتخاب شده

در برخی موارد، ممکن است بخواهید فقط یک تست (یا زیرمجموعه‌ای از تست‌ها) از مجموعه‌های خود را اجرا کنید.

با پارامتر `--spec`، می‌توانید مشخص کنید که کدام _مجموعه_ (Mocha، Jasmine) یا _ویژگی_ (Cucumber) باید اجرا شود. مسیر نسبت به دایرکتوری کاری فعلی شما تعیین می‌شود.

به عنوان مثال، برای اجرای فقط تست ورود خود:

```sh
wdio wdio.conf.js --spec ./test/specs/e2e/login.js
```

یا چندین مشخصه را همزمان اجرا کنید:

```sh
wdio wdio.conf.js --spec ./test/specs/signup.js --spec ./test/specs/forgot-password.js
```

اگر مقدار `--spec` به یک فایل مشخصه خاص اشاره نکند، برای فیلتر کردن نام‌های فایل مشخصه تعریف شده در پیکربندی شما استفاده می‌شود.

برای اجرای تمام مشخصاتی که کلمه "dialog" در نام فایل مشخصه دارند، می‌توانید از:

```sh
wdio wdio.conf.js --spec dialog
```

توجه داشته باشید که هر فایل تست در یک فرآیند اجرای تست واحد اجرا می‌شود. از آنجا که ما فایل‌ها را از قبل اسکن نمی‌کنیم (برای اطلاعات در مورد لوله کردن نام‌های فایل به `wdio` به بخش بعدی مراجعه کنید)، شما _نمی‌توانید_ (به عنوان مثال) از `describe.only` در بالای فایل مشخصه خود برای دستور دادن به Mocha برای اجرای فقط آن مجموعه استفاده کنید.

این ویژگی به شما کمک می‌کند تا به همان هدف برسید.

هنگامی که گزینه `--spec` ارائه می‌شود، هر الگویی که توسط پیکربندی یا سطح قابلیت پارامتر `specs` تعریف شده است را لغو می‌کند.

## حذف تست‌های انتخاب شده

در صورت نیاز، اگر می‌خواهید فایل(های) مشخصه خاصی را از اجرا حذف کنید، می‌توانید از پارامتر `--exclude` (Mocha، Jasmine) یا ویژگی (Cucumber) استفاده کنید.

به عنوان مثال، برای حذف تست ورود خود از اجرای تست:

```sh
wdio wdio.conf.js --exclude ./test/specs/e2e/login.js
```

یا، چندین فایل مشخصه را حذف کنید:

 ```sh
wdio wdio.conf.js --exclude ./test/specs/signup.js --exclude ./test/specs/forgot-password.js
```

یا، یک فایل مشخصه را هنگام فیلتر کردن با استفاده از یک مجموعه حذف کنید:

```sh
wdio wdio.conf.js --suite login --exclude ./test/specs/e2e/login.js
```

اگر مقدار `--exclude` به یک فایل مشخصه خاص اشاره نکند، برای فیلتر کردن نام‌های فایل مشخصه تعریف شده در پیکربندی شما استفاده می‌شود.

برای حذف تمام مشخصاتی که کلمه "dialog" در نام فایل مشخصه دارند، می‌توانید از:

```sh
wdio wdio.conf.js --exclude dialog
```

هنگامی که گزینه `--exclude` ارائه می‌شود، هر الگویی که توسط پیکربندی یا سطح قابلیت پارامتر `exclude` تعریف شده است را لغو می‌کند.

## اجرای مجموعه‌ها و مشخصات تست

یک مجموعه کامل را همراه با مشخصات فردی اجرا کنید.

```sh
wdio wdio.conf.js --suite login --spec ./test/specs/signup.js
```

## اجرای چندین مشخصه تست خاص

گاهی اوقات لازم است - در زمینه یکپارچه‌سازی مداوم و غیره - مجموعه‌های متعددی از مشخصات را برای اجرا مشخص کنید. ابزار خط فرمان `wdio` در WebdriverIO نام‌های فایل لوله‌شده (از `find`، `grep` یا دیگران) را می‌پذیرد.

نام‌های فایل لوله‌شده، لیست الگوها یا نام‌های فایل مشخص شده در لیست `spec` پیکربندی را لغو می‌کنند.

```sh
grep -r -l --include "*.js" "myText" | wdio wdio.conf.js
```

_**توجه:** این پرچم `--spec` را برای اجرای یک مشخصه واحد _لغو نمی‌کند_._

## اجرای تست‌های خاص با MochaOpts

همچنین می‌توانید با ارسال یک آرگومان خاص mocha: `--mochaOpts.grep` به CLI wdio، فیلتر کنید که کدام `suite|describe` و/یا `it|test` خاص را می‌خواهید اجرا کنید.

```sh
wdio wdio.conf.js --mochaOpts.grep myText
wdio wdio.conf.js --mochaOpts.grep "Text with spaces"
```

_**توجه:** Mocha پس از ایجاد نمونه‌ها توسط اجراکننده تست WDIO، تست‌ها را فیلتر می‌کند، بنابراین ممکن است چندین نمونه را ببینید که راه‌اندازی شده‌اند اما عملاً اجرا نمی‌شوند._

## حذف تست‌های خاص با MochaOpts

همچنین می‌توانید با ارسال یک آرگومان خاص mocha: `--mochaOpts.invert` به CLI wdio، فیلتر کنید که کدام `suite|describe` و/یا `it|test` خاص را می‌خواهید حذف کنید. `--mochaOpts.invert` عکس `--mochaOpts.grep` عمل می‌کند.

```sh
wdio wdio.conf.js --mochaOpts.grep "string|regex" --mochaOpts.invert
wdio wdio.conf.js --spec ./test/specs/e2e/login.js --mochaOpts.grep "string|regex" --mochaOpts.invert
```

_**توجه:** Mocha پس از ایجاد نمونه‌ها توسط اجراکننده تست WDIO، تست‌ها را فیلتر می‌کند، بنابراین ممکن است چندین نمونه را ببینید که راه‌اندازی شده‌اند اما عملاً اجرا نمی‌شوند._

## توقف تست پس از شکست

با گزینه `bail`، می‌توانید به WebdriverIO بگویید که پس از شکست هر تست، تست را متوقف کند.

این برای مجموعه‌های تست بزرگ مفید است، زمانی که از قبل می‌دانید بیلد شما شکست خواهد خورد، اما می‌خواهید از انتظار طولانی برای اجرای کامل تست جلوگیری کنید.

گزینه `bail` انتظار یک عدد را دارد، که مشخص می‌کند چند شکست تست می‌تواند رخ دهد قبل از اینکه WebDriver کل اجرای تست را متوقف کند. مقدار پیش‌فرض `0` است، به این معنی که همیشه تمام مشخصات تستی را که می‌تواند پیدا کند اجرا می‌کند.

لطفاً برای اطلاعات بیشتر در مورد پیکربندی bail به [صفحه گزینه‌ها](configuration) مراجعه کنید.
## سلسله مراتب گزینه‌های اجرا

هنگام اعلام اینکه چه مشخصاتی را اجرا کنید، سلسله مراتب خاصی وجود دارد که تعیین می‌کند کدام الگو اولویت خواهد داشت. در حال حاضر، اینطور است، از بالاترین اولویت به پایین‌ترین:

> آرگومان CLI `--spec` > الگوی `specs` قابلیت > الگوی `specs` پیکربندی
> آرگومان CLI `--exclude` > الگوی `exclude` پیکربندی > الگوی `exclude` قابلیت

اگر فقط پارامتر پیکربندی داده شود، برای تمام قابلیت‌ها استفاده خواهد شد. با این حال، اگر الگو را در سطح قابلیت تعریف کنید، به جای الگوی پیکربندی از آن استفاده خواهد شد. در نهایت، هر الگوی مشخصی که در خط فرمان تعریف شده باشد، همه الگوهای دیگر را لغو خواهد کرد.

### استفاده از الگوهای مشخصه تعریف شده توسط قابلیت

وقتی یک الگوی مشخصه را در سطح قابلیت تعریف می‌کنید، هر الگویی که در سطح پیکربندی تعریف شده باشد را لغو می‌کند. این زمانی مفید است که نیاز به جداسازی تست‌ها بر اساس قابلیت‌های متمایز دستگاه دارید. در چنین مواردی، استفاده از یک الگوی مشخصه عمومی در سطح پیکربندی و الگوهای خاص‌تر در سطح قابلیت مفیدتر است.

به عنوان مثال، فرض کنید دو دایرکتوری داشتید، یکی برای تست‌های Android و دیگری برای تست‌های iOS.

فایل پیکربندی شما ممکن است الگو را به صورت زیر تعریف کند، برای تست‌های دستگاه غیر خاص:

```js
{
    specs: ['tests/general/**/*.js']
}
```

اما سپس، قابلیت‌های متفاوتی برای دستگاه‌های Android و iOS خود خواهید داشت، که الگوها می‌توانند به صورت زیر باشند:

```json
{
  "platformName": "Android",
  "specs": [
    "tests/android/**/*.js"
  ]
}
```

```json
{
  "platformName": "iOS",
  "specs": [
    "tests/ios/**/*.js"
  ]
}
```

اگر هر دو این قابلیت‌ها را در فایل پیکربندی خود نیاز داشته باشید، پس دستگاه Android فقط تست‌های تحت فضای نام "android" را اجرا خواهد کرد و تست‌های iOS فقط تست‌های تحت فضای نام "ios" را اجرا خواهند کرد!

```js
//wdio.conf.js
export const config = {
    "specs": [
        "tests/general/**/*.js"
    ],
    "capabilities": [
        {
            platformName: "Android",
            specs: ["tests/android/**/*.js"],
            //...
        },
        {
            platformName: "iOS",
            specs: ["tests/ios/**/*.js"],
            //...
        },
        {
            platformName: "Chrome",
            //config level specs will be used
        }
    ]
}
```