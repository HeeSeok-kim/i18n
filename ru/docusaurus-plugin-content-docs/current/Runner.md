---
id: runner
title: Раннер
---

import CodeBlock from '@theme/CodeBlock';

Раннер в WebdriverIO организует то, как и где запускаются тесты при использовании testrunner. WebdriverIO в настоящее время поддерживает два различных типа раннеров: локальный и браузерный.

## Локальный раннер

[Локальный раннер](https://www.npmjs.com/package/@wdio/local-runner) инициирует ваш фреймворк (например, Mocha, Jasmine или Cucumber) в рабочем процессе и запускает все ваши тестовые файлы в среде Node.js. Каждый тестовый файл запускается в отдельном рабочем процессе для каждой capability, что обеспечивает максимальную параллельность. Каждый рабочий процесс использует один экземпляр браузера и, таким образом, запускает собственную сессию браузера, обеспечивая максимальную изоляцию.

Поскольку каждый тест запускается в собственном изолированном процессе, невозможно обмениваться данными между тестовыми файлами. Существует два способа обойти это:

- использовать [`@wdio/shared-store-service`](https://www.npmjs.com/package/@wdio/shared-store-service) для обмена данными между всеми рабочими процессами
- группировать spec-файлы (подробнее в [Organizing Test Suite](https://webdriver.io/docs/organizingsuites#grouping-test-specs-to-run-sequentially))

Если в `wdio.conf.js` не определено иное, Локальный раннер является раннером по умолчанию в WebdriverIO.

### Установка

Для использования Локального раннера вы можете установить его через:

```sh
npm install --save-dev @wdio/local-runner
```

### Настройка

Локальный раннер является раннером по умолчанию в WebdriverIO, поэтому нет необходимости определять его в вашем `wdio.conf.js`. Если вы хотите явно его указать, вы можете определить его следующим образом:

```js
// wdio.conf.js
export const {
    // ...
    runner: 'local',
    // ...
}
```

## Браузерный раннер

В отличие от [Локального раннера](https://www.npmjs.com/package/@wdio/local-runner), [Браузерный раннер](https://www.npmjs.com/package/@wdio/browser-runner) инициирует и выполняет фреймворк внутри браузера. Это позволяет вам запускать модульные тесты или компонентные тесты в реальном браузере, а не в JSDOM, как во многих других тестовых фреймворках.

Хотя [JSDOM](https://www.npmjs.com/package/jsdom) широко используется для целей тестирования, в конечном итоге это не настоящий браузер, и с его помощью невозможно эмулировать мобильные среды. С помощью этого раннера WebdriverIO позволяет легко запускать тесты в браузере и использовать команды WebDriver для взаимодействия с элементами, отображаемыми на странице.

Вот обзор запуска тестов в JSDOM по сравнению с браузерным раннером WebdriverIO:

| | JSDOM | WebdriverIO Browser Runner |
|-|-------|----------------------------|
|1.| Запускает ваши тесты в Node.js, используя повторную реализацию веб-стандартов, в частности, стандартов WHATWG DOM и HTML | Выполняет ваш тест в реальном браузере и запускает код в той среде, которую используют ваши пользователи |
|2.| Взаимодействия с компонентами могут быть только имитированы через JavaScript | Вы можете использовать [WebdriverIO API](api) для взаимодействия с элементами через протокол WebDriver |
|3.| Поддержка Canvas требует [дополнительных зависимостей](https://www.npmjs.com/package/canvas) и [имеет ограничения](https://github.com/Automattic/node-canvas/issues) | У вас есть доступ к реальному [Canvas API](https://developer.mozilla.org/en-US/docs/Web/API/Canvas_API) |
|4.| JSDOM имеет некоторые [оговорки](https://github.com/jsdom/jsdom#caveats) и неподдерживаемые Web API | Все Web API поддерживаются, так как тест запускается в реальном браузере |
|5.| Невозможно обнаружить ошибки в разных браузерах | Поддержка всех браузеров, включая мобильные |
|6.| __Не может__ тестировать псевдосостояния элементов | Поддержка псевдосостояний, таких как `:hover` или `:active` |

Этот раннер использует [Vite](https://vitejs.dev/) для компиляции вашего тестового кода и загрузки его в браузер. Он поставляется с предустановками для следующих компонентных фреймворков:

- React
- Preact
- Vue.js
- Svelte
- SolidJS
- Stencil

Каждый тестовый файл/группа тестовых файлов запускается в рамках одной страницы, что означает, что между каждым тестом страница перезагружается для обеспечения изоляции между тестами.

### Установка

Для использования Браузерного раннера вы можете установить его через:

```sh
npm install --save-dev @wdio/browser-runner
```

### Настройка

Чтобы использовать браузерный раннер, необходимо определить свойство `runner` в файле `wdio.conf.js`, например:

```js
// wdio.conf.js
export const {
    // ...
    runner: 'browser',
    // ...
}
```

### Опции раннера

Браузерный раннер допускает следующие конфигурации:

#### `preset`

Если вы тестируете компоненты с использованием одного из упомянутых выше фреймворков, вы можете определить предустановку, которая гарантирует, что все настроено "из коробки". Эту опцию нельзя использовать вместе с `viteConfig`.

__Тип:__ `vue` | `svelte` | `solid` | `react` | `preact` | `stencil`<br />
__Пример:__

```js title="wdio.conf.js"
export const {
    // ...
    runner: ['browser', {
        preset: 'svelte'
    }],
    // ...
}
```

#### `viteConfig`

Определите вашу собственную [конфигурацию Vite](https://vitejs.dev/config/). Вы можете передать пользовательский объект или импортировать существующий файл `vite.conf.ts`, если вы используете Vite.js для разработки. Обратите внимание, что WebdriverIO сохраняет пользовательские конфигурации Vite для настройки тестового окружения.

__Тип:__ `string` или [`UserConfig`](https://github.com/vitejs/vite/blob/52e64eb43287d241f3fd547c332e16bd9e301e95/packages/vite/src/node/config.ts#L119-L272) или `(env: ConfigEnv) => UserConfig | Promise<UserConfig>`<br />
__Пример:__

```js title="wdio.conf.ts"
import viteConfig from '../vite.config.ts'

export const {
    // ...
    runner: ['browser', { viteConfig }],
    // или просто:
    runner: ['browser', { viteConfig: '../vites.config.ts' }],
    // или используйте функцию, если ваша конфигурация vite содержит много плагинов,
    // которые вы хотите разрешить только при чтении значения
    runner: ['browser', {
        viteConfig: () => ({
            // ...
        })
    }],
    // ...
}
```

#### `headless`

Если установлено значение `true`, раннер обновит capabilities для запуска тестов в безголовом режиме. По умолчанию это включено в средах CI, где переменная среды `CI` установлена на `'1'` или `'true'`.

__Тип:__ `boolean`<br />
__По умолчанию:__ `false`, устанавливается на `true`, если переменная среды `CI` установлена

#### `rootDir`

Корневой каталог проекта.

__Тип:__ `string`<br />
__По умолчанию:__ `process.cwd()`

#### `coverage`

WebdriverIO поддерживает отчеты о покрытии тестами через [`istanbul`](https://istanbul.js.org/). Подробнее см. в разделе [Опции покрытия](#coverage-options).

__Тип:__ `object`<br />
__По умолчанию:__ `undefined`

### Опции покрытия

Следующие опции позволяют настроить отчеты о покрытии.

#### `enabled`

Включает сбор данных о покрытии.

__Тип:__ `boolean`<br />
__По умолчанию:__ `false`

#### `include`

Список файлов, включенных в покрытие, в виде шаблонов glob.

__Тип:__ `string[]`<br />
__По умолчанию:__ `[**]`

#### `exclude`

Список файлов, исключенных из покрытия, в виде шаблонов glob.

__Тип:__ `string[]`<br />
__По умолчанию:__

```
[
  'coverage/**',
  'dist/**',
  'packages/*/test{,s}/**',
  '**/*.d.ts',
  'cypress/**',
  'test{,s}/**',
  'test{,-*}.{js,cjs,mjs,ts,tsx,jsx}',
  '**/*{.,-}test.{js,cjs,mjs,ts,tsx,jsx}',
  '**/*{.,-}spec.{js,cjs,mjs,ts,tsx,jsx}',
  '**/__tests__/**',
  '**/{karma,rollup,webpack,vite,vitest,jest,ava,babel,nyc,cypress,tsup,build}.config.*',
  '**/.{eslint,mocha,prettier}rc.{js,cjs,yml}',
]
```

#### `extension`

Список расширений файлов, которые должен включать отчет.

__Тип:__ `string | string[]`<br />
__По умолчанию:__ `['.js', '.cjs', '.mjs', '.ts', '.mts', '.cts', '.tsx', '.jsx', '.vue', '.svelte']`

#### `reportsDirectory`

Каталог для записи отчета о покрытии.

__Тип:__ `string`<br />
__По умолчанию:__ `./coverage`

#### `reporter`

Используемые репортеры покрытия. См. [документацию istanbul](https://istanbul.js.org/docs/advanced/alternative-reporters/) для подробного списка всех репортеров.

__Тип:__ `string[]`<br />
__По умолчанию:__ `['text', 'html', 'clover', 'json-summary']`

#### `perFile`

Проверка пороговых значений для каждого файла. См. `lines`, `functions`, `branches` и `statements` для фактических пороговых значений.

__Тип:__ `boolean`<br />
__По умолчанию:__ `false`

#### `clean`

Очистка результатов покрытия перед запуском тестов.

__Тип:__ `boolean`<br />
__По умолчанию:__ `true`

#### `lines`

Пороговое значение для строк.

__Тип:__ `number`<br />
__По умолчанию:__ `undefined`

#### `functions`

Пороговое значение для функций.

__Тип:__ `number`<br />
__По умолчанию:__ `undefined`

#### `branches`

Пороговое значение для ветвей.

__Тип:__ `number`<br />
__По умолчанию:__ `undefined`

#### `statements`

Пороговое значение для операторов.

__Тип:__ `number`<br />
__По умолчанию:__ `undefined`

### Ограничения

При использовании браузерного раннера WebdriverIO важно отметить, что диалоги, блокирующие поток, такие как `alert` или `confirm`, не могут использоваться нативно. Это связано с тем, что они блокируют веб-страницу, что означает, что WebdriverIO не может продолжать общение со страницей, вызывая зависание выполнения.

В таких ситуациях WebdriverIO предоставляет стандартные моки с значениями по умолчанию для этих API. Это гарантирует, что если пользователь случайно использует синхронные всплывающие веб-API, выполнение не зависнет. Однако все же рекомендуется пользователю мокировать эти веб-API для лучшего опыта. Подробнее в [Mocking](/docs/component-testing/mocking).

### Примеры

Обязательно ознакомьтесь с документацией по [компонентному тестированию](https://webdriver.io/docs/component-testing) и посмотрите [пример репозитория](https://github.com/webdriverio/component-testing-examples) для примеров использования этих и различных других фреймворков.