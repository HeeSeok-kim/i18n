---
id: component-testing
title: Тестирование компонентов
---

С помощью [Browser Runner](/docs/runner#browser-runner) WebdriverIO вы можете запускать тесты в реальном настольном или мобильном браузере, используя WebdriverIO и протокол WebDriver для автоматизации и взаимодействия с тем, что отображается на странице. Этот подход имеет [множество преимуществ](/docs/runner#browser-runner) по сравнению с другими тестовыми фреймворками, которые позволяют тестировать только с помощью [JSDOM](https://www.npmjs.com/package/jsdom).

## Как это работает?

Browser Runner использует [Vite](https://vitejs.dev/) для рендеринга тестовой страницы и инициализации тестового фреймворка для запуска ваших тестов в браузере. В настоящее время он поддерживает только Mocha, но Jasmine и Cucumber [находятся в разработке](https://github.com/orgs/webdriverio/projects/1). Это позволяет тестировать любые компоненты, даже для проектов, которые не используют Vite.

Сервер Vite запускается тестраннером WebdriverIO и настраивается так, чтобы вы могли использовать все репортеры и сервисы, как и для обычных e2e-тестов. Кроме того, он инициализирует экземпляр [`browser`](/docs/api/browser), который позволяет получить доступ к подмножеству [API WebdriverIO](/docs/api) для взаимодействия с любыми элементами на странице. Как и в e2e-тестах, вы можете получить доступ к этому экземпляру через переменную `browser`, прикрепленную к глобальной области видимости, или импортируя ее из `@wdio/globals`, в зависимости от настройки [`injectGlobals`](/docs/api/globals).

WebdriverIO имеет встроенную поддержку следующих фреймворков:

- [__Nuxt__](https://nuxt.com/): Тестраннер WebdriverIO обнаруживает приложение Nuxt и автоматически настраивает компоненты проекта и помогает имитировать бэкенд Nuxt, подробнее в [документации Nuxt](/docs/component-testing/vue#testing-vue-components-in-nuxt)
- [__TailwindCSS__](https://tailwindcss.com/): Тестраннер WebdriverIO определяет, используете ли вы TailwindCSS, и правильно загружает среду на тестовую страницу

## Настройка

Чтобы настроить WebdriverIO для модульного тестирования или тестирования компонентов в браузере, инициализируйте новый проект WebdriverIO через:

```bash
npm init wdio@latest ./
# или
yarn create wdio ./
```

Когда запустится мастер настройки, выберите `browser` для запуска модульного тестирования и тестирования компонентов, и выберите один из предустановленных вариантов, если нужно, или выберите _"Other"_, если вы хотите запускать только базовые модульные тесты. Вы также можете настроить пользовательскую конфигурацию Vite, если уже используете Vite в своем проекте. Дополнительную информацию можно найти во всех [опциях раннера](/docs/runner#runner-options).

:::info

__Примечание:__ WebdriverIO по умолчанию запускает тесты браузера в CI в безголовом режиме, например, когда переменная окружения `CI` установлена на `'1'` или `'true'`. Вы можете вручную настроить это поведение с помощью опции [`headless`](/docs/runner#headless) для раннера.

:::

В конце этого процесса вы должны найти `wdio.conf.js`, содержащий различные конфигурации WebdriverIO, включая свойство `runner`, например:

```ts reference useHTTPS runmeRepository="git@github.com:webdriverio/example-recipes.git" runmeFileToOpen="component-testing%2FREADME.md"
https://github.com/webdriverio/example-recipes/blob/fd54f94306ed8e7b40f967739164dfe4d6d76b41/wdio.comp.conf.js
```

Определяя различные [capabilities](/docs/configuration#capabilities), вы можете запускать тесты в разных браузерах, параллельно, если нужно.

Если вы все еще не уверены, как все работает, посмотрите следующий учебник о том, как начать работу с тестированием компонентов в WebdriverIO:

<LiteYouTubeEmbed
    id="5vp_3tGtnMc"
    title="Getting Started with Component Testing in WebdriverIO"
/>

## Тестовая среда

Вы сами решаете, что запускать в своих тестах и как отображать компоненты. Однако мы рекомендуем использовать [Testing Library](https://testing-library.com/) в качестве вспомогательного фреймворка, так как он предоставляет плагины для различных фреймворков компонентов, таких как React, Preact, Svelte и Vue. Он очень полезен для рендеринга компонентов на тестовой странице и автоматически очищает эти компоненты после каждого теста.

Вы можете комбинировать примитивы Testing Library с командами WebdriverIO по своему усмотрению, например:

```js reference useHTTPS
https://github.com/webdriverio/example-recipes/blob/fd54f94306ed8e7b40f967739164dfe4d6d76b41/component-testing/svelte-example.js
```

__Примечание:__ использование методов рендеринга из Testing Library помогает удалять созданные компоненты между тестами. Если вы не используете Testing Library, убедитесь, что прикрепили свои тестовые компоненты к контейнеру, который очищается между тестами.

## Настроечные скрипты

Вы можете настроить свои тесты, запуская произвольные скрипты в Node.js или в браузере, например, внедрение стилей, мокирование API браузера или подключение к стороннему сервису. Хуки WebdriverIO [hooks](/docs/configuration#hooks) можно использовать для запуска кода в Node.js, в то время как [`mochaOpts.require`](/docs/frameworks#require) позволяет импортировать скрипты в браузер перед загрузкой тестов, например:

```js wdio.conf.js
export const config = {
    // ...
    mochaOpts: {
        ui: 'tdd',
        // предоставление настроечного скрипта для запуска в браузере
        require: './__fixtures__/setup.js'
    },
    before: () => {
        // настройка тестовой среды в Node.js
    }
    // ...
}
```

Например, если вы хотите мокировать все вызовы [`fetch()`](https://developer.mozilla.org/en-US/docs/Web/API/fetch) в вашем тесте со следующим настроечным скриптом:

```js ./fixtures/setup.js
import { fn } from '@wdio/browser-runner'

// запуск кода перед загрузкой всех тестов
window.fetch = fn()

export const mochaGlobalSetup = () => {
    // запуск кода после загрузки тестового файла
}

export const mochaGlobalTeardown = () => {
    // запуск кода после выполнения файла спецификации
}

```

Теперь в ваших тестах вы можете предоставить пользовательские значения ответов для всех запросов браузера. Подробнее о глобальных фикстурах читайте в [документации Mocha](https://mochajs.org/#global-fixtures).

## Отслеживание тестовых и прикладных файлов

Существует несколько способов отладки ваших тестов в браузере. Самый простой - запустить тестраннер WebdriverIO с флагом `--watch`, например:

```sh
$ npx wdio run ./wdio.conf.js --watch
```

Это сначала запустит все тесты и остановится, когда все они будут выполнены. Затем вы можете вносить изменения в отдельные файлы, которые будут повторно запускаться индивидуально. Если вы установите [`filesToWatch`](/docs/configuration#filestowatch), указывающий на файлы вашего приложения, все тесты будут перезапускаться при внесении изменений в ваше приложение.

## Отладка

Хотя пока не возможно установить точки останова в вашей IDE и чтобы они были распознаны удаленным браузером, вы можете использовать команду [`debug`](/docs/api/browser/debug) для остановки теста в любой точке. Это позволяет открыть DevTools для последующей отладки теста путем установки точек останова на [вкладке sources](https://buddy.works/tutorials/debugging-javascript-efficiently-with-chrome-devtools).

При вызове команды `debug` вы также получите интерфейс REPL Node.js в своем терминале с сообщением:

```
The execution has stopped!
You can now go into the browser or use the command line as REPL
(To exit, press ^C again or type .exit)
```

Нажмите `Ctrl` или `Command` + `c` или введите `.exit`, чтобы продолжить тест.

## Запуск с использованием Selenium Grid

Если у вас настроен [Selenium Grid](https://www.selenium.dev/documentation/grid/) и вы запускаете браузер через этот грид, вам нужно установить опцию `host` для браузерного раннера, чтобы браузер мог получить доступ к правильному хосту, где обслуживаются тестовые файлы, например:

```ts title=wdio.conf.ts
export const config: WebdriverIO.Config = {
    runner: ['browser', {
        // сетевой IP машины, которая запускает процесс WebdriverIO
        host: 'http://172.168.0.2'
    }]
}
```

Это обеспечит правильное открытие браузером нужного экземпляра сервера, размещенного на экземпляре, который запускает тесты WebdriverIO.

## Примеры

Вы можете найти различные примеры тестирования компонентов с использованием популярных фреймворков компонентов в нашем [репозитории примеров](https://github.com/webdriverio/component-testing-examples).